<html>
<head>
    <link rel="stylesheet" href="https://trello.com/power-ups/power-up.css">
    <script src="https://trello.com/power-ups/power-up.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>
<body>
<form id="urlForm">
    <label for="url">WMS GetCapabilities URL H:</label>
    <input name="url" id="url" type="text">
    <button type="submit" class="mod-primary">Save</button>
</form>
<script>
    var t = TrelloPowerUp.iframe();

    var xmlContent =

        window.urlForm.addEventListener('submit', function (event) {
            event.preventDefault();
            var url = window.url.value;
            console.log('url', url);
            // TODO: validate https; validate 1.3.0

            //var gc = $.parseXML(url);
            //console.log('gc', gc);

        $.ajax({
            url: url,
            dataType: "xml",
            success: function (gc) {
                console.log("loaded data", gc);
                console.log("loaded data", $(gc));
                console.log("loaded data", $('Name', gc));

                var xml = $.parseXML(gc);
                console.log(xml);

                t.closePopup();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.error('error in getCapabilities loading', url);
                t.closePopup();
            }
        });

//            $.ajax({
//                url: url,
//                dataType: 'xml',
//                success: function (data) {
//                    console.log('data', data);
//                    console.log('data', $(data));
//                    // Extract relevant data from XML
//                    var xml_node = $('Pages', data);
//                    console.log(xml_node.find('Page[Name="test"] > controls > test').text());
//                },
//                error: function (data) {
//                    console.log('Error loading XML data');
//                }
            });


        });


</script>
</body>
</html>